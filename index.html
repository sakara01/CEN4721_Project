
<!DOCTYPE html>

<html lang='en'>
    <head>
        <meta charset="UTF-8">
        <title>CEN4721_Project</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    </head>
    <body>
        
        <div id="grid-container" class="grid-container">
            <div class="grid-top">
                <div class="title-navbar">
                  <div class="title">Harmony Stream</div>
                </div>
                  <div class="navbar">
                    <button id="toggleNavbar">View My playlist</button>
                    <div class="navbar-content" id="navbar">
                        <a class="nav-link" href="#">Link 1</a>
                        <a class="nav-link" href="#">Link 2</a>
                        <a class="nav-link" href="#">Link 3</a>
                    </div>
                  </div>
                
              </div>
          <!--
          <div class="grid-bottom-left">
            <h1></h1>
          </div>
          <div class="grid-bottom-right">
              <h1></h1>
          </div>
          -->
        </div>

        <div id="main-screen">
          <div id="sidebar"> 
            <div id="sidebar-header">
              Sort By
            </div>
            <div id="tag-option-list">
                  <button id="Joyful" class="btn oval-button" style="background-color: #edbf36" onclick="tagClicked(id)">#Joyful</button>
                  <br>
                  <button id="Energetic" class="btn oval-button" style="background-color: #3698ed" onclick="tagClicked(id)">#Energetic</button>
                  <br>
                  <button id="Melancholic" class="btn oval-button" style="background-color: #c4614b" onclick="tagClicked(id)">#Melancholic</button>
                  <br>
                  <button id="Angry" class="btn oval-button" style="background-color: #65b850" onclick="tagClicked(id)">#Angry</button>
                  <br>
                  <button id="Romantic" class="btn oval-button" style="background-color: #e464a9" onclick="tagClicked(id)">#Romantic</button>
                  <br>
                  <button id="Relaxing" class="btn oval-button" style="background-color: #4bc4aa" onclick="tagClicked(id)">#Relaxing</button>
                  <br>
                  <button id="Euphoric" class="btn oval-button" style="background-color: #3698ed" onclick="tagClicked(id)">#Euphoric</button>
                  <br>
                  <button id="Mysterious" class="btn oval-button" style="background-color: #c4614b" onclick="tagClicked(id)">#Mysterious</button>
                  <br>
                  <button id="Playful" class="btn oval-button" style="background-color: #65b850" onclick="tagClicked(id)">#Playful</button>
                  <br>
                  <button id="Empowering" class="btn oval-button" style="background-color: #65b850" onclick="tagClicked(id)">#Empowering</button>
                  
            </div>
            <div>
              <button class="btn btn-secondary btn-lg search-btn" onclick="searchClicked()">Search</button>
            </div>
          </div>
          <div id="main">
            <div id="main-header">
              Search
              <div class="input-group mb-3 searchbar">
                <input type="text" class="form-control" id="searchInput" placeholder="Artist's Name" aria-label="Search term" aria-describedby="basic-addon2">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary" type="button" id="clearSearch">X</button>
                </div>
              </div>
              <div class="container-container">      
                <div id="notfound" class="found-or-not-container">
                  <img src="no-results.png" class="found-or-not-img">
                </div>
                <div id="search" class="found-or-not-container">
                  <img src="search.png" class="found-or-not-img">
                </div>
              </div>

              <div id="playlist-container">   
              </div>
            </div>
            </div>
          </div>
        </div>
    </body>
    <script>

        var genres ='';
        var artist;
        var artistName;
        var artistId;

        document.getElementById("searchInput").value = "";  //clear search bar on load
        
        document.getElementById("main-screen").style.height = window.innerHeight - 90 + 'px';
        document.getElementById("playlist-container").style.height = (window.innerHeight - 280) + 'px';


        document.getElementById("toggleNavbar").addEventListener("click", function() {
        var navbar = document.getElementById("navbar");
        if (navbar.style.display === "block") {
          navbar.style.display = "none";
        } else {
          navbar.style.display = "block";
        }
        }); 

        document.getElementById("clearSearch").addEventListener("click", function() {
          document.getElementById("searchInput").value = ""; // Clear the input field
        });

        
        const CLIENT_ID = 'fb2c7009a8f4407ca01b0da46c45750a';
        const CLIENT_SECRET = 'af63502a913d49a3ab20b95681a42fdf';
        var accessToken;

        // Encode your client ID and client secret
        const credentials = btoa(`${CLIENT_ID}:${CLIENT_SECRET}`);

        // Define the token request URL
        const tokenUrl = 'https://accounts.spotify.com/api/token';

        // Set up the token request parameters
        const tokenRequestParams = {
            method: 'POST',
            headers: {
                'Authorization': `Basic ${credentials}`,
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: 'grant_type=client_credentials'
        };

        // Make the request to obtain the access token
        fetch(tokenUrl, tokenRequestParams)
            .then(response => response.json())
            .then(data => {
                accessToken = data.access_token;
                // You can now use this access token to make requests to the Spotify API
                console.log('Access Token:', accessToken);
            })
            .catch(error => console.error('Error:', error));



        const lastfmKEY= '4eb3fe2b8c857843a5f02285f350c541';
        const lastfmSECRET= 'cf4c824d370be3ad4674798b74d335f8';

        

        document.getElementById("searchInput").addEventListener("keyup", function(event) {
          if (event.key === "Enter") {
              // Get the value from the search input
              artist = this.value;
              console.log("Search term:", artist);
              const searchUrl = `https://api.spotify.com/v1/search?q=${encodeURIComponent(artist)}&type=artist`;

              // Set up the request to search for the artist
              const artistSearchRequestParams = {
                  method: 'GET',
                  headers: {
                      'Authorization': `Bearer ${accessToken}`
                  }
                };
                // Make the request to search for the artist
              fetch(searchUrl, artistSearchRequestParams)
                  .then(response => response.json())
                  .then(data => {
                      // Handle the search results here
                      console.log('Artist Search Results:', data);
                      if (data.artists && data.artists.items.length > 0) {
                          artistName = data.artists.items[0].name;
                          artistId = data.artists.items[0].id; // Assuming you want the top artist

                          // Request the top tracks of the artist
                          const topTracksUrl = `https://api.spotify.com/v1/artists/${artistId}/top-tracks?country=US&offset=7`; // Change the country code as needed

                          const topTracksRequestParams = {
                            method: 'GET',
                            headers: {
                              'Authorization': `Bearer ${accessToken}`
                            }
                          };

                          // Make the request to get the top tracks
                          fetch(topTracksUrl, topTracksRequestParams)
                            .then(response => response.json())
                            .then(topTracksData => {
                              // Handle the top tracks results here
                              console.log('Top Tracks:', topTracksData.tracks);
                              displaySongs(topTracksData.tracks);
                            })
                            .catch(error => console.error('Error fetching top tracks:', error));
                      } else {
                        console.log('No artist found with the given search term.');
                        document.getElementById("playlist-container").innerHTML = ``;
                        document.getElementById("search").style.visibility = 'hidden';
                        document.getElementById("notfound").style.visibility = 'visible';
                        
                      }
                                
                  })
                  .catch(error => console.error('Error:', error));
                }
        });

        function displaySongs(songData){
          document.getElementById("playlist-container").innerHTML = ``;
          for(i in songData){
            var song = songData[i];
            addSong(song);
          }
        }

        function addSong(song){
          document.getElementById("playlist-container").innerHTML += `<div class="list-group" style="max-height: 600px; overflow-y: auto;">
                            <div class="list-group-item list-group-item-action playlist-entry">
                                <div class="cover-container">
                                <img src="musicnote.png" class="cover-img" alt="add to playlist button">
                                </div>
                                <div class="playlist-entry-text1">
                                  <p class="mb-1 song">${song.name}</p>
                                  <p class="mb-1 artist">${song.artists[0].name}</p>
                                </div>
                                <div class="playlist-entry-text2">
                                  <p class="mb-1 album">${song.album.name}</p>
                                </div>
                                <div class="img-container">
                                    <img src="plus.png" class="add-btn" alt="add to playlist button">
                                </div>
                        </div>`;
        }
         

        function tagClicked(id){
          console.log(id);
          document.getElementById(id).style.border = '4px solid black';
          switch(id){
            case "Joyful":
              console.log("switchcase");
              genres += "Pop, Ska, Reggae, Funk, Disco, electro pop";
              break;
            case "Energetic":
              genres += "Rock, Electronic (EDM, Techno), Punk, Hip-Hop, Reggaeton, dance, electro pop, electropop";
              break;
            case "Melancholic":
              genres += "Blues, Classical (Adagios), Country (Country Ballads), Folk (Sad Folk), Jazz (Bluesy Jazz), indie";
              break;
            case "Angry":
              genres += "Metal (Thrash, Death, Black), Hardcore Punk, Grunge, Rap (Gangsta Rap), Industrial";
              break;
            case "Romantic":
              genres +=  "RnB,R&B Soul, Ballads, Reggae (Love Songs), Country (Country Love), indie";
              break;
            case "Relaxing":
              genres += "Ambient, Downtempo, Jazz (Smooth Jazz), Electronic (Chillout, Chillwave), New Age, dream pop, indie";
              break;
            case "Euphoric":
              genres +=  "Trance, Psychedelic, House, Psytrance, EDM, electro pop";
              break;
            case "Mysterious":
              genres += "Trip-Hop, Experimental, Darkwave, Industrial, Post-Rock";
              break;
            case "Playful":
              genres +=  "Folk (Folk Revival), Children's Music, Novelty, J-Pop/K-Pop, Ska";
              break;
            case "Empowering":
              genres += "Hip-Hop (Empowerment anthems), Rock (Classic Rock, Hard Rock), Pop (Upbeat Pop), Reggae (Roots Reggae), Funk (Funky grooves), indie";
              break;
          }
        }

        function searchClicked(){
          if (artist== undefined){
            alert("Please select artist");
            //possibly searach by genre without artist
          }
          else{
            document.getElementById("playlist-container").innerHTML=``;

            //make request to get songs
            const topTracksUrl = `https://api.spotify.com/v1/artists/${artistId}/top-tracks?country=US&limit=20`; // Change the country code as needed
            const topTracksRequestParams = {
              method: 'GET',
              headers: {
                'Authorization': `Bearer ${accessToken}`
              }
            };
            fetch(topTracksUrl, topTracksRequestParams)
              .then(response => response.json())
              .then(topTracksData => {
                // Handle the top tracks results here
                console.log('Top Tracks:', topTracksData.tracks);
                //check tags of each song, if matches the genres, add to display on screen
                for(i in topTracksData.tracks){
                  checktags(topTracksData.tracks[i]);
                }
              })
              .catch(error => console.error('Error fetching top tracks:', error));

            
          }
        }

        function checktags(song){
            //if tag matches genres, do addSong
            const genreURL = `http://ws.audioscrobbler.com/2.0/?method=track.gettoptags&artist=${artistName}&track=${song.name}&api_key=${lastfmKEY}&format=json`;
            const genreSearchRequestParams = {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                  };
              // Make the request to search for the artist
            fetch(genreURL, genreSearchRequestParams)
                .then(response => response.json())
                .then(data => {
                  //console.log(data);
                  console.log(song.name);    //delete
                  genresLower=genres.toLowerCase();
                  if(data.toptags){
                    if (data.toptags.tag[0] !=null) {
                      tag0Lower=data.toptags.tag[0].name.toLowerCase();
                    }
                    if (data.toptags.tag[1] !=null){
                      tag1Lower=data.toptags.tag[1].name.toLowerCase()
                      console.log(`tags:${tag0Lower},${tag1Lower}`) //delete

                      if (genresLower.includes(tag0Lower) || genresLower.includes(tag1Lower)){
                        addSong(song);
                      }
                    }
                  }
                  
                });
        }


    </script>
</html>



<!--credits:
music icon : https://www.vecteezy.com/png/1200758-music-note
no results icon: https://www.flaticon.com/free-icon/no-results_6179016

-->





